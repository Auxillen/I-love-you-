<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf, 8" />
  <meta name="viewport" content="width=device, width, initial, scale=1, user, scalable=no" />
  <title>Love Letter Generator for Cristal</title>
  <meta name="theme, color" content="#ffb6d9" />
  <style>
    :root{
      , , bg:#fff0f9; , , card:#ffffff; , , ink:#2a2a2a; , , accent:#d86bff; , , accent2:#ff6fa9; , , muted:#7b7b7b;
    }
    *{box, sizing:border, box}
    html,body{height:100%}
    body{margin:0;font, family:system, ui,, apple, system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans, serif;background:linear, gradient(135deg,var(, , bg),#ffe6f7);color:var(, , ink);overflow, x:hidden}
    .fade, in{animation:fadeIn 0.8s ease forwards}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .pulse{animation:pulse 2.4s infinite}
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.06)}100%{transform:scale(1)}}
    .app{max, width:680px;margin:0 auto;min, height:100%;display:flex;flex, direction:column;}
    header{padding:18px 16px;display:flex;align, items:center;gap:10px;position:sticky;top:0;background:linear, gradient(180deg, var(, , bg), rgba(255,240,249,0.7));backdrop, filter:saturate(140%) blur(6px);z, index:5}
    .logo{width:42px;height:42px;border, radius:14px;background:linear, gradient(135deg,var(, , accent),var(, , accent2));display:grid;place, items:center;color:white;font, weight:800;box, shadow:0 6px 18px rgba(255,111,169,.35)}
    h1{font, size:20px;margin:0;color:#9b4bd8}
    main{padding:16px;display:flex;flex, direction:column;gap:14px}
    .card{background:var(, , card);border, radius:22px;box, shadow:0 12px 28px rgba(216,107,255,.15), 0 4px 12px rgba(0,0,0,.05);padding:18px;transition:transform 0.2s, box, shadow .2s}
    .card:hover{transform:translateY(, 3px);box, shadow:0 16px 34px rgba(216,107,255,.22), 0 6px 14px rgba(0,0,0,.06)}
    .controls{display:grid;grid, template, columns:1fr 1fr;gap:10px}
    .controls button, .controls .full{grid, column:span 2}
    button{appearance:none;border:0;border, radius:16px;padding:14px 16px;background:linear, gradient(135deg,var(, , accent),var(, , accent2));color:#fff;font, weight:700;font, size:16px;box, shadow:0 8px 18px rgba(216,107,255,.35);touch, action:manipulation;transition:transform .12s ease, opacity .2s ease}
    button:hover{opacity:0.93}
    button:active{transform:scale(0.97)}
    button.ghost{background:#fff;color:var(, , accent2);border:2px solid var(, , accent2);box, shadow:none}
    button.secondary{background:#111;color:#fff}
    .note{font, size:18px;line, height:1.6;white, space:pre, wrap;color:#4a2a4a;min, height:130px}
    .muted{color:var(, , muted);font, size:13px}
    .row{display:flex;gap:10px;align, items:center}
    input, textarea{width:100%;padding:12px 14px;border, radius:12px;border:1px solid #e8e8e8;background:#fff;box, shadow:0 1px 0 #00000008 inset;font, size:16px}
    textarea{min, height:90px;resize:vertical}
    details{background:var(, , card);border, radius:18px;padding:10px 12px}
    summary{cursor:pointer;font, weight:700;list, style:none;color:#9b4bd8}
    summary::, webkit, details, marker{display:none}
    .chip{display:inline, flex;align, items:center;gap:6px;border:1px dashed #ffc2db;color:#c83b78;background:#fff6fb;padding:6px 10px;border, radius:999px;font, size:12px}
    .footer{padding:20px 16px 40px;text, align:center;color:var(, , muted);font, size:12px}
    .heart{display:inline, block;transform:translateY(3px)}
    .hidden{display:none}
    .blink{animation:blink 1s step, end infinite}
    @keyframes blink{50%{opacity:0}}
  </style>
</head>
<body>
  <div class="app">
    <header class="fade, in">
      <div class="logo pulse">‚ô•</div>
      <div>
        <h1>For Cristal</h1>
        <div class="muted" id="subtitle">A  üíú note every time you tap</div>
      </div>
      <div style="margin, left:auto" class="chip" id="daysTogether">4 months</div>
    </header>

    <main>
      <section class="card fade, in">
        <div class="note" id="output">Tap ‚ÄúGenerate‚Äù to craft a new love letter just for you, ma lune. üíå</div>
        <div class="muted" id="stamp"></div>
        <div class="controls" style="margin, top:12px">
          <button id="gen">Generate</button>
          <button class="ghost" id="save">Save to Gallery (PNG)</button>
          <button class="secondary full" id="share">Share / Copy</button>
        </div>
      </section>

      <section class="card fade, in">
        <div class="row">
          <input id="partner" placeholder="Cristal" value="Cristal" />
        </div>
        <div class="row" style="margin, top:8px">
          <input id="fromName" placeholder="Your name or nickname" />
        </div>
        <div class="muted" style="margin, top:6px">Names personalize each letter (e.g., ‚ÄúDear Cristal ‚ô•‚Äù). Tap the months chip to set your start date.</div>
      </section>

      <details class="fade, in">
        <summary>‚úèÔ∏è Add your own reasons</summary>
        <div class="card" style="margin, top:10px">
          <textarea id="customReasons" placeholder="Write one reason per line‚Ä¶"></textarea>
          <div class="row" style="margin, top:10px;flex, wrap:wrap">
            <button id="addReasons">Add</button>
            <button class="ghost" id="exportReasons">Export</button>
            <button class="ghost" id="importReasons">Import</button>
            <input id="fileInput" type="file" accept="application/json" class="hidden" />
          </div>
          <div class="muted" style="margin, top:8px">Your reasons are saved only on this device (offline) using localStorage.</div>
        </div>
      </details>

      <details class="fade, in">
        <summary>üñºÔ∏è Saved Gallery (<span id="galleryCount">0</span>)</summary>
        <div class="card" style="margin, top:10px">
          <div id="gallery" style="display:grid;grid, template, columns:1fr 1fr;gap:10px"></div>
          <div class="muted" style="margin, top:10px">Long, press an item to delete it.</div>
        </div>
      </details>

      <section class="footer fade, in">Made with endless üíñ and üíú for Cristal, celebrating 4 months of us. No distance can dull what we share, and every tap here is another small reminder of how much you mean to me. Even through the quiet moments, you‚Äôre always the reason I smile. This little generator will never run out of words for you, because my love for you only grows.</section>
    </main>
  </div>

  <canvas id="canvas" class="hidden"></canvas>

  <script>
    // , , ,  Utilities & State , , , 
    const $ = (q)=>document.querySelector(q);
    const state = {
      partner: 'Cristal',
      from: localStorage.getItem('ll_from') || '',
      reasons: JSON.parse(localStorage.getItem('ll_reasons')||'null') || [
        "Cristal, your laugh is the spark that brightens my whole day.",
        "You check on me even when I forget to check on myself.",
        "You make distance feel like a delay, not a barrier.",
        "Every goodnight from you feels like a hug I can keep.",
        "You turn tiny moments into memories I replay.",
        "You remember details no one else notices‚Äîand it makes me feel seen.",
        "Your voice calms the loud parts of my mind.",
        "You celebrate my wins like they‚Äôre yours.",
        "Even on tough days, you still choose us.",
        "We can sit in silence and it still feels like home.",
        "You‚Äôre my favorite notification.",
        "You make me want to be softer, braver, kinder.",
        "I love the way you say my name.",
        "You‚Äôre honest with your heart and gentle with mine.",
        "You make every countdown worth it.",
        "You‚Äôre the place my thoughts go to rest.",
        "Your smile lives on my lock screen and in my head.",
        "You make ordinary days feel like little holidays.",
        "I love how you hype me up without being asked.",
        "You see the best in me, and remind me of it.",
        "You‚Äôre sunshine and moonlight, in perfect shifts.",
        "Your patience makes our love feel safe.",
        "You‚Äôre the reason my phone battery dies happily.",
        "I love the silly inside jokes only we get.",
        "You text me at the exact moment I need you.",
        "You‚Äôre the dream I get to keep while I‚Äôm awake.",
        "You ask about my day and actually care about the answers.",
        "You make me feel chosen, not just wanted.",
        "Hearing your ‚Äòhi‚Äô resets my whole mood.",
        "You make the future feel like a warm room with lights on.",
        "You notice when I‚Äôm quiet and hold space for me.",
        "You‚Äôre the soft landing after my long days.",
        "I love planning little surprises for you.",
        "You‚Äôre the best part of my routines.",
        "I save your messages like postcards from home.",
        "You make me feel lucky in a way I can‚Äôt explain.",
        "You‚Äôre my peace, even in pieces.",
        "You turn my what-ifs into we, gots, this.",
        "Your laugh is the soundtrack of my favorite scenes.",
        "You make waiting feel like building, not wasting.",
        "I love the way you care for others‚Äîit shows your heart.",
        "You ask the sweetest follow-up questions.",
        "You keep me grounded and lifted at the same time.",
        "You make me braver about love.",
        "You‚Äôre the reason I count hours and not miles.",
        "You make promises feel like places we‚Äôll arrive at.",
        "You‚Äôre my calm cup of tea on stormy nights.",
        "You turn random Tuesdays into anniversaries of tiny moments.",
        "You don‚Äôt let me forget I‚Äôm loved.",
        "You‚Äôre the smile I wear in crowded rooms.",
        "You turn my phone into a portal back to you.",
        "You make me feel like the best version of myself.",
        "You‚Äôre the ‚Äòping‚Äô that sounds like home.",
        "You listen to understand, not just reply.",
        "You‚Äôre the soft glow after the sun sets.",
        "You remind me what gentle love looks like.",
        "You notice when I‚Äôm overwhelmed and slow the world down.",
        "You give me butterflies and comfort at once.",
        "You turn our distance into a story worth telling.",
        "Your good mornings feel like fresh starts.",
        "You‚Äôre the reason I look forward to tomorrow.",
        "You make me feel chosen every single day.",
        "You melt my worry with a single emoji.",
        "You‚Äôre my favorite place, even through a screen.",
        "You make home a person, not a place.",
        "You make me laugh when I‚Äôm trying to be mad.",
        "You make ‚Äòsee you soon‚Äô feel real.",
        "You‚Äôre kind in ways that don‚Äôt need an audience.",
        "You take care of love like it‚Äôs alive‚Äîbecause it is.",
        "You‚Äôre my softest constant.",
        "You remember my favorites and make them special.",
        "You‚Äôre the reason my walls have windows.",
        "You make time zones feel like a puzzle we solve together.",
        "You are my safest yes.",
        "Your voice note replays are my lullaby.",
        "You send me memes like love letters in disguise.",
        "You make me feel seen on my quiet days.",
        "You help me believe good things last.",
        "You make the word ‚Äòus‚Äô feel holy.",
        "You‚Äôre the reason sunsets look warmer lately.",
        "You make me excited to grow older together.",
        "You say ‚Äòtake your time‚Äô and mean it.",
        "You‚Äôre magic without tricks.",
        "You hold space for my feelings like they matter.",
        "You make the long weeks softer.",
        "You are the echo I wait for and the answer I love.",
        "You‚Äôre the note at the end of every playlist.",
        "You make my heart speak in exclamation points.",
        "You‚Äôre my favorite plan A‚Äîand plan B.",
        "You make me want to write you poems.",
        "You‚Äôre the reason I check the moon.",
        "You make me feel like I‚Äôm worth waiting for too.",
        "You‚Äôre gentle with my past and excited for my future.",
        "You make my day feel complete.",
        "You‚Äôre my lucky timing.",
        "You help me carry things I don‚Äôt have words for.",
        "You‚Äôre the reason I know what tenderness is.",
        "You make ordinary messages feel like warm hands.",
        "You‚Äôre the home screen of my heart.",
        "You add color to my grayscale mornings.",
        "You‚Äôre the lyric I never skip.",
        "You make promises feel easy to keep.",
        "You‚Äôre the plot twist I‚Äôm grateful for.",
        "You turn ‚Äòlater‚Äô into ‚Äòsoon‚Äô.",
        "You‚Äôre the quiet miracle in my day.",
        "You make me feel lucky just to exist at the same time.",
        "You‚Äôre the cozy hoodie I never want to take off.",
        "You make love look like everyday kindness.",
        "You are my favorite hello and my softest goodnight.",
        "You turn my doubts into little lights.",
        "You‚Äôre the person I want to tell everything to first.",
        "You make me feel chosen when I need it most.",
        "You‚Äôre proof that love can be gentle and still strong.",
        "You make me proud to love you out loud.",
        "You‚Äôre the reason I‚Äôm smiling at my phone again.",
        "You make our story my favorite thing to reread.",
        "You‚Äôre the steady beat in my busy day.",
        "You make me count down with a happy heart.",
        "You‚Äôre my safest secret and my brightest truth.",
        "You make me want to be better, for us.",
        "You turn ‚ÄòI miss you‚Äô into motivation, not sadness.",
        "You‚Äôre the softest place I land.",
        "You make love feel like the most natural thing.",
        "You‚Äôre my favorite constant in a changing world.",
        "You make me believe we‚Äôre exactly where we‚Äôre meant to be.",
        "You‚Äôre the calm glow between my worries.",
        "You turn miles into smiles.",
        "You‚Äôre the sweet in my everyday.",
        "You make my heart feel at home.",
        "You‚Äôre my always, even now."
      ],
      gallery: JSON.parse(localStorage.getItem('ll_gallery')||'[]'),
      since: localStorage.getItem('ll_since') || ''
    };

    // Init
    $('#partner').value = state.partner;
    $('#fromName').value = state.from;
    renderGallery();
    computeMonths();

    function computeMonths(){
      const chip = $('#daysTogether');
      if(!state.since){ chip.textContent = '4 months'; return; }
      const start = new Date(state.since);
      if(isNaN(+start)){ chip.textContent = '4 months'; return; }
      const now = new Date();
      let months = (now.getFullYear(), start.getFullYear())*12 + (now.getMonth(), start.getMonth());
      if(now.getDate()<start.getDate()) months , = 1;
      chip.textContent = months + (months===1?' month':' months');
    }

    // , , ,  Typing effect , , , 
    async function typeText(el, text){
      el.textContent = '';
      for(let i=0;i<text.length;i++){
        el.textContent += text[i];
        await new Promise(r=>setTimeout(r, 8));
      }
    }

    // , , ,  Generator , , , 
    function pick(arr){ return arr[Math.floor(Math.random()*arr.length)] }

    function generateNote(){
      const dear = state.partner ? `Dear ${state.partner},` : 'Dear you,';
      const middle = pick(state.reasons);
      const closing = state.from ? `\n\nWith love,\n${state.from}` : '\n\nWith love.';
      const stamp = new Date().toLocaleString();
      const text = `${dear}\n\n${middle}\n${closing}`;
      typeText($('#output'), text);
      $('#stamp').textContent = stamp;
      return {text, stamp};
    }

    // , , ,  Canvas export (PNG) , , , 
    function saveAsImage(text){
      const canvas = $('#canvas');
      const ctx = canvas.getContext('2d');
      const W = 1080, H = 1350, P = 64; // phone, friendly export
      canvas.width = W; canvas.height = H;
      // Background gradient
      const grad = ctx.createLinearGradient(0,0,W,H);
      grad.addColorStop(0,'#fff0f9');
      grad.addColorStop(1,'#ffe6f7');
      ctx.fillStyle = grad; ctx.fillRect(0,0,W,H);
      // Rounded white card
      roundRect(ctx, P, P, W, P*2, H, P*2, 40, '#ffffff');
      // Title
      ctx.fillStyle = '#9b4bd8';
      ctx.font = 'bold 36px Inter, , apple, system, system, ui';
      ctx.fillText('For Cristal', P+40, P+50);
      // Body
      ctx.fillStyle = '#4a2a4a';
      wrapText(ctx, text, P+40, P+110, W, (P+40)*2, 48, '28px Inter, , apple, system, system, ui');
      // Stamp
      ctx.font = '16px Inter, , apple, system, system, ui';
      ctx.fillStyle = '#7b7b7b';
      ctx.fillText(new Date().toLocaleString(), P+40, H, P, 30);
      const url = canvas.toDataURL('image/png');
      addToGallery(url, text);
      download(url, 'love, note.png');
    }

    function roundRect(ctx, x,y,w,h,r, fill){
      ctx.beginPath();
      ctx.moveTo(x+r, y);
      ctx.arcTo(x+w, y, x+w, y+h, r);
      ctx.arcTo(x+w, y+h, x, y+h, r);
      ctx.arcTo(x, y+h, x, y, r);
      ctx.arcTo(x, y, x+w, y, r);
      ctx.closePath();
      ctx.fillStyle = fill; ctx.fill();
    }

    function wrapText(ctx, text, x, y, maxWidth, lineHeight, font){
      ctx.font = font; ctx.textBaseline='top';
      const words = text.split(/\s+/);
      let line = '';
      for(let i=0;i<words.length;i++){
        const test = line + words[i] + ' ';
        if(ctx.measureText(test).width > maxWidth && i>0){
          ctx.fillText(line, x, y); y+=lineHeight; line = words[i] + ' ';
        } else { line = test; }
      }
      ctx.fillText(line, x, y);
    }

    function download(url, name){
      const a=document.createElement('a'); a.href=url; a.download=name; a.click();
    }

    // , , ,  Gallery , , , 
    function addToGallery(url, text){
      state.gallery.unshift({url, text, t:+new Date});
      localStorage.setItem('ll_gallery', JSON.stringify(state.gallery));
      renderGallery();
    }

    function renderGallery(){
      const wrap = $('#gallery');
      const count = $('#galleryCount');
      wrap.innerHTML = '';
      count.textContent = state.gallery.length;
      state.gallery.forEach((item, idx)=>{
        const fig = document.createElement('figure');
        fig.style.margin=0; fig.style.position='relative'; fig.style.borderRadius='14px'; fig.style.overflow='hidden'; fig.style.boxShadow='0 6px 14px rgba(0,0,0,.08)';
        const img = document.createElement('img');
        img.src=item.url; img.alt='Saved note'; img.style.width='100%'; img.style.display='block';
        fig.appendChild(img);
        fig.addEventListener('contextmenu', e=>e.preventDefault());
        let pressTimer;
        fig.addEventListener('touchstart', ()=>{ pressTimer=setTimeout(()=>{ del(idx); },700); }, {passive:true});
        fig.addEventListener('touchend', ()=>clearTimeout(pressTimer));
        fig.addEventListener('mousedown', ()=>{ pressTimer=setTimeout(()=>{ del(idx); },700); });
        fig.addEventListener('mouseup', ()=>clearTimeout(pressTimer));
        wrap.appendChild(fig);
      });
      function del(i){ if(confirm('Delete this saved note?')){ state.gallery.splice(i,1); localStorage.setItem('ll_gallery', JSON.stringify(state.gallery)); renderGallery(); } }
    }

    // , , ,  Events , , , 
    $('#gen').addEventListener('click', ()=>generateNote());
    $('#save').addEventListener('click', ()=>{ const {text}=generateNote(); saveAsImage(text); });
    $('#share').addEventListener('click', async ()=>{
      const {text} = generateNote();
      if(navigator.share){
        try{ await navigator.share({ text }); }catch(e){ }
      } else {
        try{ await navigator.clipboard.writeText(text); alert('Copied to clipboard!'); }catch{ alert('Share not supported. Text copied (if allowed).'); }
      }
    });

    $('#partner').addEventListener('input', (e)=>{ state.partner=e.target.value.trim(); });
    $('#fromName').addEventListener('input', (e)=>{ state.from=e.target.value.trim(); localStorage.setItem('ll_from', state.from); });

    // Import / Export / Add
    $('#addReasons').addEventListener('click', ()=>{
      const raw = $('#customReasons').value.trim();
      if(!raw){ alert('Write at least one line'); return; }
      const lines = raw.split(/\n+/).map(s=>s.trim()).filter(Boolean);
      state.reasons = [...new Set([...state.reasons, ...lines])];
      localStorage.setItem('ll_reasons', JSON.stringify(state.reasons));
      $('#customReasons').value='';
      alert('Added! Your list now has '+state.reasons.length+' reasons.');
    });

    $('#exportReasons').addEventListener('click', ()=>{
      const data = new Blob([JSON.stringify({reasons:state.reasons}, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(data);
      download(url, 'reasons.json');
      setTimeout(()=>URL.revokeObjectURL(url), 800);
    });

    $('#importReasons').addEventListener('click', ()=>$('#fileInput').click());
    $('#fileInput').addEventListener('change', (e)=>{
      const file = e.target.files[0]; if(!file) return;
      const r = new FileReader();
      r.onload = ()=>{
        try{
          const json = JSON.parse(r.result);
          if(Array.isArray(json.reasons)){
            state.reasons = [...new Set([...state.reasons, ...json.reasons.filter(Boolean)])];
            localStorage.setItem('ll_reasons', JSON.stringify(state.reasons));
            alert('Imported! Total reasons: '+state.reasons.length);
          } else { alert('Invalid file format.'); }
        }catch{ alert('Could not read file.'); }
      };
      r.readAsText(file);
    });

    // Set start date via chip
    $('#daysTogether').addEventListener('click', ()=>{
      const val = prompt('Enter your start date (YYYY, MM, DD). Optional.');
      if(val){ state.since=val; localStorage.setItem('ll_since', val); computeMonths(); }
    })
  </script>
</body>
</html>
